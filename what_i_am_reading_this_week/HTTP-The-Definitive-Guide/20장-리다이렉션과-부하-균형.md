### 20.1 왜 리다이렉트인가?
- 웹 콘텐츠는 지연 최소화, 네트워크 대역폭 절약을 위해 여러 장소에 배포되는데, 최적의 분산 콘텐츠를 찾아주기 위한 기법의 집합이 리다이렉션이다.

### 20.2 리다이렉트할 곳
- 서버, 프락시, 캐시, 게이트웨이는 클라이언트의 요청을 처리한다는 관점에서 보면 공통적으로 서버의 특성을 갖고 있다. 
> 그러나 어떤 리다이렉션 기술들은 특정 종류의 종단만을 위해 특별히 설계되어 일반적인 적용이 불가능하다.(p523) 

### 20.4 일반적인 리다이렉션 방법
**HTTP 리다이렉션**
- 리다이렉팅 서버가 가용 서버 중 가장 부하가 적은 곳으로 요청을 리다이렉트한다.
- 클라이언트가 요청 -> 서버가 302 상태코드와 함께 리다이렉트 메시지로 응답 -> 클라이언트가 리다이렉트할 서버로 재요청 -> 해당 서버에서 200 상태코드로 응답
- 하지만 단점이 있다. 어떤 서버로 리다이렉트할 지 결정하기 위해 많은 처리가 필요하고, 두 번의 왕복으로 사용자가 오래 기다리며, 리다이렉트 서버가 고장나면 사이트가 작동을 안 한다는 것.
- 그래서 HTTP 리다이렉션은 다른 리다이렉션 기법과 함께 사용된다.

**DNS 리다이렉션**
> DNS는 한 도메인에 여러 아이피 주소가 결부되는 것을 허용하며, 이 중 어떤 아이피 주소를 선택할 것인지 결정해야 한다.
- DNS 라운드 로빈 : 가장 단순하고 흔히 사용되는 리다이렉션 기법. 웹 서버 팜 전체의 부하 균형을 유지하기 위해 목록 첫 번째 주소를 사용하되, 
DNS 룩업이 끝날 때마다 주소들을 순환시킨다.
- DNS 캐싱의 효과 : DNS 주소 순환은 부하를 순환시킨다. 하지만 호스트 하나에 대한 DNS 룩업을 수행한 뒤, 그 주소를 계속 사용함으로써 부하 균형이 제대로 분산되지 않을 가능성이 있다.
> DNS 라운드 로빈은 일반적으로 하나의 클라이언트로 인한 부하를 제대로 분산하지 못한다. <br>
> 그러나 비록 DNS가 단일 클라이언트의 트랜잭션을 서버의 복제들에게 나눠주지는 않더라도, 그것은 여러 클라이언트들의 부하 총량을 분산하는 적절한 작업을 수행한다. 비슷한 요청을 하는 클라이언트의 수가 어느 정도 이상만 된다면, 부하는 모든 서버에 걸쳐 상대적으로 잘 분산될 것이다.(p531)
- 주소 순서를 결정하기 위한 다른 DNS 알고리즘 기법에는 부하 균형 알고리즘, 근접 라우팅 알고리즘, 결합 마스킹 알고리즘이 있다.
- 부하 균형 알고리즘은 웹서버의 로드를 추적해 가장 로드가 적은 웹 서버를 목록 상위에 놓는다.
- 근접 라우팅 알고리즘은 팜이 지리적으로 분산돼있는 경우, 사용자와 근접한 웹 서버로 라우팅한다.
- 결합 마스킹 알고리즘은 네트워크 상태를 모니터링하면서 장애를 피해 라우팅한다.
> 일반적으로, 복잡한 서버 추적 알고리즘을 실행하고 있는 DNS 서버는 콘텐츠 제공자의 통제 하에 있는 권위 있는 서버다.<br>
https://www.techveze.com/understanding-dns-architecture/ <--- 다시 읽어볼 것.

**임의 캐스트 어드레싱**
- 클라이언트와 가장 가까운 서버로 라우팅하기 위해, 백본 라우터의 최단거리 라우팅 능력에 의존하는 리다이렉션 기법이다.
- 지리적으로 흩어진 웹 서버들은 같은 아이피 주소를 갖고 있고, 백본 라우터는 자신이 해당 웹 서버들과 가장 인접한 라우터라고 광고한다.
- 백본 라우터가 임의 캐스트 주소를 향하는 패킷을 받으면, 자신에게 가장 인접한 서버로 라우팅한다.
- 웹서버는 라우터 통신 프로토콜을 이용해 인접한 백본 라우터와 대화한다.
> 분산 임의 캐스트의 동작을 위해, 서버는 반드시 '라우터의 언어로 말해야 하고' 라우터는 일어날 수 있는 주소 충돌을 반드시 다룰 수 있어야 한다.(p533)

**아이피 맥 포워딩** (p534) ----> 이해안됨
- 이더넷에서 HTTP 메시지는 패킷 형태로 보내지는데, 각 패킷은 레이어-4 주소인 아이피 주소와 포트 번호 외에도, 레이어-2 주소인 미디어 접근 컨트롤(Media Access Control:MAC) 주소도 갖고 있다.
> 레이어-2 장비의 역할은 들어오는 특정 MAC 주소의 패킷을 받아서 나가는 특정 MAC 주소로 포워딩하는 것이다.<br>
> MAC 포워딩을 지원하는 레이어-4 스위치는 보통 요청을 여러 프락시 캐시로 보낼 수 있고 그들 사이의 부하 균형을 유지할 수 있다.<br> 
> MAC 주소 포워딩은 점대 점으로만 가능하기 때문에, 서버나 프락시는 스위치와 한 홉 거리에 위치해야 한다.

**아이피 주소 포워딩** (p535) ----> 이해안됨
- 레이어-4를 이해하는 장비는 패킷의 TCP/IP 어드레싱을 검증하고 아이피 주소 변경에 따라 라우팅한다.
- 맥 포워딩과 달리 목적지 서버가 한 홉 거리에 있을 필요가 없다.
> 그러나 라우팅 대칭성때문에 TCP 커넥션을 관리하는 스위치는 반드시 그 커넥션을 통해서 클라이언트에게 응답을 돌려주어야 하므로, 목적지 서버나 프락시로부터의 응답은 반드시 스위치에게 돌아가야 한다.<br>
- 응답 귀환 경로를 제어할 수 있는 방법은 두 가지다.
> 패킷의 출발지 아이피 주소를 스위치의 아이피 주소로 바꾼다. 목적지와 출발지의 아이피주소 양쪽을 번역하는 장치를 완전 NAT이라고 하는데, 그러면 결제나 인증 시 웹 서버가 클라이언트의 아이피 주소를 알 수 없게 된다.<br>
> 만약 출발지 아이피 주소가 그대로 남아있다면, 서버에서 클라이언트로 바로 가는 경로가 존재하지 않아야 한다. 여기서 장점은 서버가 클라이언트 아이피 주소를 얻는다는 거싱며, 단점은 클라이언트와 서버 사이의 네트워크 전체에 약간의 통제가 필요하다는 것이다.<br>

**네트워크 구성요소 제어 프로토콜(Network Element Control Protocol, NECP)**
> 패킷을 전달하는 라우터나 스위치 같은 네트워크 구성요소(NE)들이 웹 서버나 프락시 캐시와 같이 애플리케이션 계층 요청을 처리하는 서버 구성요소들(SE)과 대화할 수 있게 해 준다.<br>
> 부하 균형을 명시적으로 지원하지는 않지만, SE는 NE에게 부하 균형 정보를 제공할 수 있는 방법을 제공하여, SE가 적합하다고 판단한 대로 NE가 부하 균형을 유지할 수 있도록 한다. 

### 20.5 프락시 리다이렉션 방법
### 20.6 캐시 리다이렉션 방법
### 20.7 인터넷 캐시 프로토콜
### 20.8 캐시 배열 라우팅 프로토콜
### 20.9 하이퍼텍스트 캐싱 프로토콜
